<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head th:replace="~{layout :: head('Crear Organización de Acopio')}"></head>
<body>
  <header th:replace="~{layout :: header}"></header>
  <main class="main">
    <div class="card" style="max-width:600px;margin:0 auto;">
      <div class="card-header"><h2 style="margin:0;">Registrar Organización de Acopio</h2></div>
      <div class="card-body">
        <form th:object="${organizacion}" th:action="@{/organizaciones/crear}" method="post">
          <div style="margin-bottom:16px;">
            <label for="nombre" style="display:block;margin-bottom:6px;font-weight:600;">Nombre</label>
            <input id="nombre" th:field="*{nombre}" type="text" style="width:100%;padding:10px;border:1px solid var(--border);background:var(--panel-dark);border-radius:8px;color:var(--text);" />
            <div style="color:var(--error);font-size:14px;margin-top:6px;" th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"></div>
          </div>
          <div style="margin-bottom:16px;">
            <label for="direccion" style="display:block;margin-bottom:6px;font-weight:600;">Dirección</label>
            <input id="direccion" th:field="*{direccion}" type="text" style="width:100%;padding:10px;border:1px solid var(--border);background:var(--panel-dark);border-radius:8px;color:var(--text);" />
            <div style="color:var(--error);font-size:14px;margin-top:6px;" th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}"></div>
          </div>
          <div style="margin-bottom:20px;">
            <label for="telefono" style="display:block;margin-bottom:6px;font-weight:600;">Teléfono</label>
            <input id="telefono" th:field="*{telefono}" type="text" style="width:100%;padding:10px;border:1px solid var(--border);background:var(--panel-dark);border-radius:8px;color:var(--text);" />
            <div style="color:var(--error);font-size:14px;margin-top:6px;" th:if="${#fields.hasErrors('telefono')}" th:errors="*{telefono}"></div>
          </div>
          
          <div style="margin-bottom:16px;">
            <label style="display:block;margin-bottom:6px;font-weight:600;">Ubicación (punto de partida)</label>
            <div id="map" style="height:300px;width:100%;border-radius:8px;border:1px solid var(--border);margin-bottom:10px;"></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
              <div>
                <label for="lat" style="font-size:12px;color:var(--muted);">Latitud</label>
                <input id="lat" th:field="*{lat}" type="number" step="0.0001" style="width:100%;padding:8px;border:1px solid var(--border);background:var(--panel-dark);border-radius:6px;color:var(--text);" />
              </div>
              <div>
                <label for="lng" style="font-size:12px;color:var(--muted);">Longitud</label>
                <input id="lng" th:field="*{lng}" type="number" step="0.0001" style="width:100%;padding:8px;border:1px solid var(--border);background:var(--panel-dark);border-radius:6px;color:var(--text);" />
              </div>
            </div>
          </div>
          
          <div style="display:flex;gap:12px;justify-content:flex-end;">
            <a href="/organizaciones" class="btn">Cancelar</a>
            <button type="submit" class="btn primary">Registrar</button>
          </div>
        </form>
      </div>
    </div>
  </main>
  <footer th:replace="~{layout :: footer}"></footer>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([-30.9064, -55.5508], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    
    let marker = L.marker([-30.9064, -55.5508]).addTo(map);
    
    map.on('click', function(e) {
      marker.setLatLng(e.latlng);
      document.getElementById('lat').value = e.latlng.lat.toFixed(4);
      document.getElementById('lng').value = e.latlng.lng.toFixed(4);
    });
    
    document.getElementById('lat').addEventListener('change', function() {
      const lat = parseFloat(this.value) || -30.9064;
      const lng = parseFloat(document.getElementById('lng').value) || -55.5508;
      marker.setLatLng([lat, lng]);
      map.setView([lat, lng], 12);
    });
    
    document.getElementById('lng').addEventListener('change', function() {
      const lat = parseFloat(document.getElementById('lat').value) || -30.9064;
      const lng = parseFloat(this.value) || -55.5508;
      marker.setLatLng([lat, lng]);
      map.setView([lat, lng], 12);
    });
  </script>
</body>
</html>
